name: Manual Deploy

on:
  workflow_dispatch:

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '22'

      - name: Install dependencies
        run: npm install

      - name: Set environment variables
        run: |
          echo "API_URL_GITHUB=${{ secrets.API_URL_GITHUB }}" >> $GITHUB_ENV
          echo "API_TOKEN_GITHUB=${{ secrets.API_TOKEN_GITHUB }}" >> $GITHUB_ENV
          echo "PORT=${{ secrets.PORT }}" >> $GITHUB_ENV

      - name: Lint the code
        run: npm run lint

  test:
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '22'

      - name: Install dependencies
        run: npm install

      - name: Set environment variables
        run: |
          echo "API_URL_GITHUB=${{ secrets.API_URL_GITHUB }}" >> $GITHUB_ENV
          echo "API_TOKEN_GITHUB=${{ secrets.API_TOKEN_GITHUB }}" >> $GITHUB_ENV
          echo "PORT=${{ secrets.PORT }}" >> $GITHUB_ENV

      - name: Run tests
        run: npm test

  build:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install Heroku CLI
        run: |
          curl https://cli-assets.heroku.com/install.sh | sh

      - name: Set up Docker
        uses: docker/setup-buildx-action@v2

      - name: Build Docker image
        run: docker build -t your-app-name .

  deploy:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Deploy to production
        uses: johnbeynon/render-deploy-action@v0.0.8
        with:
          service-id: ${{ secrets.MY_RENDER_SERVICE_ID }}
          api-key: ${{ secrets.MY_RENDER_API_KEY }}

  # deploy:
  #   runs-on: ubuntu-latest
  #   needs: build
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v2

  #     - name: Install Heroku CLI
  #       run: |
  #         curl https://cli-assets.heroku.com/install.sh | sh

  #     - name: Set up Heroku
  #       uses: akhileshns/heroku-deploy@v3.13.15
  #       with:
  #         heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
  #         heroku_app_name: ${{ secrets.HEROKU_API_NAME }}
  #         heroku_email: ${{ secrets.HEROKU_API_EMAIL }}

  #     - name: Deploy to Heroku
  #       run: git push https://git.Paramesh98/github-insight-backend.git HEAD:refs/heads/main
